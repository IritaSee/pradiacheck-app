<MainScreen>:

    # Properti yang dibutuhkan untuk fungsi Python (asumsi)
    preview_image: ''
    is_loading: False
    show_error: False
    error_message: ""
    has_result: False
    prediction_text: "Normal"
    confidence_text: "99.8%"
    prognosis_color: 0.1, 0.5, 0.1, 1 # Hijau untuk Normal
    prognosis_bg_color: 0.8, 1, 0.8, 1 # Latar belakang hijau muda

    # KANVAS UTAMA: Tetap menggunakan seluruh layar untuk warna background
    canvas.before:
        Color:
            rgba: 0.886, 0.478, 0.415, 1 # Warna merah-oranye lembut
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: 'vertical'

        # 1. HEADER (FULL WIDTH - TIDAK KENA PADDING)
        AnchorLayout:
            anchor_x: 'center'
            anchor_y: 'center'
            size_hint_y: None
            height: dp(70)
            padding: dp(10)
            canvas.before:
                Color:
                    rgba: 0.8, 0.84, 0.89, 1 # Abu-abu Kebiruan
                Rectangle:
                    pos: self.pos
                    size: self.size

            BoxLayout:
                orientation: 'horizontal'
                size_hint: None, None
                width: self.minimum_width
                height: dp(40)
                spacing: dp(5)

                Image:
                    source: "logo1.png"
                    size_hint_x: None
                    width: dp(40)

                Label:
                    text: "Pradiacheck.AI"
                    font_size: dp(24)
                    bold: True
                    color: 0.886, 0.478, 0.415, 1
                    size_hint_x: None
                    width: self.texture_size[0]
                    valign: 'middle'

        # =========================================================
        # 2. JUMBOTRON (FULL WIDTH)
        # =========================================================
        RelativeLayout:
            size_hint_y: None
            height: (self.width) * 0.6
            
            # Canvas Background Jumbotron
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

            # Gambar Jumbotron (FULL-BLEED)
            Image:
                source: 'jumbotron.jpeg'
                allow_stretch: True
                keep_ratio: False
                size_hint: 1, 1
                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                opacity: 0.69

            # Lapisan gelap dan teks di atas gambar
            BoxLayout:
                orientation: 'vertical'
                padding: dp(20)
                size_hint: 1, 1

                canvas.before:
                    Color:
                        rgba: 0, 0, 0, 0.4 # --- LAPISAN GELAP DIKEMBALIKAN ---
                    Rectangle:
                        pos: self.parent.pos
                        size: self.parent.size

                # Konten teks
                BoxLayout:
                    orientation: 'vertical'

                    Label:
                        text: "Welcome to"
                        font_size: dp(18)
                        # --- WARNA TEKS KEMBALI PUTIH ---
                        color: 1, 1, 1, 1 
                        bold: True
                        halign: 'center'
                        valign: 'middle'
                        size_hint_y: None
                        height: dp(30)
                        
                    # Teks Utama (Pradiacheck.AI)
                    RelativeLayout:
                        size_hint_y: 1
                        
                        # --- SHADOW LABEL DIKEMBALIKAN UNTUK TEKS UTAMA ---
                        Label:
                            text: "Pradiacheck.AI"
                            font_size: dp(40)
                            color: 0, 0, 0, 0.5 # Warna bayangan (hitam dengan opasitas)
                            bold: True
                            halign: 'center'
                            valign: 'middle'
                            pos: self.parent.pos[0] + dp(2), self.parent.pos[1] - dp(2)
                            pos_hint: {'center_x': 0.5, 'center_y': 0.5} 

                        # Teks Asli (Di atas bayangan)
                        Label:
                            text: "Pradiacheck.AI"
                            font_size: dp(40)
                            # --- WARNA TEKS KEMBALI PUTIH ---
                            color: 1, 1, 1, 1 
                            bold: True
                            halign: 'center'
                            valign: 'middle'
                            pos_hint: {'center_x': 0.5, 'center_y': 0.5}

        # Spacer untuk memisahkan Jumbotron dan Konten
        Widget:
            size_hint_y: None
            height: dp(20)

        # 3. KONTEN UTAMA DENGAN PADDING KANAN & KIRI SAJA (Dibungkus ScrollView)
        AnchorLayout:
            size_hint: 1, 1
            padding: dp(20), 0, dp(20), 0

            # WRAPPER KONTEN
            BoxLayout:
                id: container_wrapper
                orientation: 'vertical'
                size_hint_y: 1
                
                # Main content dengan ScrollView
                ScrollView:
                    id: scroll_view
                    do_scroll_x: False
                    padding: 0, dp(20), 0, 0

                    # KONTEN PEMBUNGKUS SCROLLVIEW
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint_y: None
                        height: self.minimum_height
                        spacing: dp(20) 
                        
                        # Container (Tutorial, Upload, Results)
                        BoxLayout:
                            orientation: 'vertical'
                            size_hint_y: None
                            height: self.minimum_height
                            padding: dp(15)
                            spacing: dp(20)
                            canvas.before:
                                Color:
                                    rgba: 0.8, 0.84, 0.89, 0.95 # Abu-abu Kebiruan Transparan
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(15)]

                            # Tutorial Section
                            BoxLayout:
                                orientation: 'vertical'
                                size_hint_y: None
                                height: self.minimum_height
                                spacing: dp(10)

                                Label:
                                    text: "How It Works"
                                    font_size: dp(20)
                                    bold: True
                                    color: 0.886, 0.478, 0.415, 1
                                    size_hint_y: None
                                    height: dp(35)

                                Label:
                                    text: "1. Take a picture of your tongue"
                                    font_size: dp(14)
                                    color: 0.2, 0.2, 0.2, 1
                                    size_hint_y: None
                                    height: self.texture_size[1] + dp(10)
                                    text_size: self.width - dp(20), None
                                    halign: 'left'
                                    valign: 'top'
                                Label:
                                    text: "2. Upload the tongue image below"
                                    font_size: dp(14)
                                    color: 0.2, 0.2, 0.2, 1
                                    size_hint_y: None
                                    height: self.texture_size[1] + dp(10)
                                    text_size: self.width - dp(20), None
                                    halign: 'left'
                                    valign: 'top'
                                Label:
                                    text: "3. Press the 'Detect' button"
                                    font_size: dp(14)
                                    color: 0.2, 0.2, 0.2, 1
                                    size_hint_y: None
                                    height: self.texture_size[1] + dp(10)
                                    text_size: self.width - dp(20), None
                                    halign: 'left'
                                    valign: 'top'
                                Label:
                                    text: "4. Wait for AI to process"
                                    font_size: dp(14)
                                    color: 0.2, 0.2, 0.2, 1
                                    size_hint_y: None
                                    height: self.texture_size[1] + dp(10)
                                    text_size: self.width - dp(20), None
                                    halign: 'left'
                                    valign: 'top'
                                Label:
                                    text: "5. The result will appear below"
                                    font_size: dp(14)
                                    color: 0.2, 0.2, 0.2, 1
                                    size_hint_y: None
                                    height: self.texture_size[1] + dp(10)
                                    text_size: self.width - dp(20), None
                                    halign: 'left'
                                    valign: 'top'

                            # Upload Section
                            BoxLayout:
                                orientation: 'vertical'
                                size_hint_y: None
                                height: self.minimum_height
                                spacing: dp(15)
                                padding: dp(15)
                                canvas.before:
                                    Color:
                                        rgba: 0, 0, 0, 0
                                    RoundedRectangle:
                                        pos: self.pos
                                        size: self.size
                                        radius: [dp(15)]

                                Label:
                                    text: "Detect Your Condition!"
                                    font_size: dp(20)
                                    bold: True
                                    color: 0.886, 0.478, 0.415, 1
                                    size_hint_y: None
                                    height: dp(35)

                                Label:
                                    text: "Upload an image of your tongue for AI-powered detection"
                                    font_size: dp(14)
                                    color: 0.33, 0.33, 0.33, 1
                                    size_hint_y: None
                                    height: dp(40)
                                    text_size: self.width - dp(20), None
                                    halign: 'center'

                                # Area untuk memilih gambar (Rasio Tinggi:Lebar = 2:3)
                                BoxLayout:
                                    size_hint_y: None
                                    height: (self.width - dp(30)) * (2/3)
                                    padding: dp(15)

                                    on_touch_down:
                                        if self.collide_point(*args[1].pos): root.select_image()

                                    canvas.before:
                                        Color:
                                            rgba: 0, 0, 0, 0
                                        Rectangle:
                                            pos: self.pos
                                            size: self.size
                                        Color:
                                            rgba: 1, 1, 1, 1
                                        Line:
                                            rounded_rectangle: self.x, self.y, self.width, self.height, dp(12)
                                            width: dp(3)
                                            dash_offset: 5
                                            dash_length: 10

                                    FloatLayout:
                                        size_hint_y: 1
                                        Image:
                                            source: 'cloud.png'
                                            markup: True
                                            opacity: 0 if root.preview_image else 1
                                            size_hint: None, None
                                            size: dp(60), dp(60)
                                            pos_hint: {'center_x': 0.5, 'center_y': 0.6}
                                        Label:
                                            text: "Tap to select an image"
                                            font_size: dp(14)
                                            color: 0.33, 0.33, 0.33, 1
                                            opacity: 0 if root.preview_image else 1
                                            pos_hint: {'center_x': 0.5, 'center_y': 0.35}
                                        Label:
                                            text: "Supported: JPG, PNG, HEIC"
                                            font_size: dp(12)
                                            color: 0.6, 0.6, 0.6, 1
                                            opacity: 0 if root.preview_image else 1
                                            pos_hint: {'center_x': 0.5, 'center_y': 0.2}
                                        Image:
                                            id: preview_img
                                            source: root.preview_image
                                            opacity: 1 if root.preview_image else 0
                                            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                                            allow_stretch: False
                                            keep_ratio: True
                                            size_hint: 0.9, 0.9

                                BoxLayout:
                                    size_hint_y: None
                                    height: dp(60) if root.show_error else 0
                                    opacity: 1 if root.show_error else 0
                                    padding: dp(10)
                                    canvas.before:
                                        Color:
                                            rgba: 1, 0.92, 0.93, 1
                                        RoundedRectangle:
                                            pos: self.pos
                                            size: self.size
                                            radius: [dp(8)]
                                    Label:
                                        text: root.error_message
                                        color: 0.78, 0.16, 0.16, 1
                                        font_size: dp(13)
                                        text_size: self.width - dp(10), None
                                        halign: 'center'
                                        valign: 'middle'

                                Button:
                                    text: "Detect" if not root.is_loading else "Processing..."
                                    size_hint_y: None
                                    height: dp(36)
                                    background_normal: ''
                                    background_color: 0.886, 0.478, 0.415, 1
                                    color: 1, 1, 1, 1
                                    font_size: dp(18)
                                    bold: True
                                    disabled: root.is_loading
                                    on_release: root.detect_image()
                                    canvas.before:
                                        Color:
                                            rgba: self.background_color if not self.disabled else [0.5, 0.5, 0.5, 1]
                                        RoundedRectangle:
                                            pos: self.pos
                                            size: self.size
                                            radius: [dp(18)]

                                # Results Section (konten di bawah tetap sama)
                                BoxLayout:
                                    id: results_section
                                    orientation: 'vertical'
                                    size_hint_y: None
                                    height: self.minimum_height
                                    spacing: dp(15)
                                    padding: dp(15)
                                    canvas.before:
                                        Color:
                                            rgba: 0.8, 0.84, 0.89, 0.95
                                        RoundedRectangle:
                                            pos: self.pos
                                            size: self.size
                                            radius: [dp(15)]

                                    Label:
                                        text: "Results"
                                        font_size: dp(20)
                                        bold: True
                                        color: 0.886, 0.478, 0.415, 1
                                        size_hint_y: None
                                        height: dp(35)

                                    BoxLayout:
                                        orientation: 'vertical'
                                        size_hint_y: None
                                        height: dp(220) if root.has_result else dp(100)
                                        padding: dp(15)
                                        spacing: dp(10)
                                        canvas.before:
                                            Color:
                                                rgba: 1, 1, 1, 1
                                            RoundedRectangle:
                                                pos: self.pos
                                                size: self.size
                                                radius: [dp(12)]

                                        Label:
                                            text: "Analysis Complete" if root.has_result else ""
                                            font_size: dp(16)
                                            bold: True
                                            color: 0.2, 0.2, 0.2, 1
                                            size_hint_y: None
                                            height: dp(25) if root.has_result else 0
                                            opacity: 1 if root.has_result else 0

                                        BoxLayout:
                                            orientation: 'vertical'
                                            size_hint_y: None
                                            height: dp(80) if root.has_result else 0
                                            opacity: 1 if root.has_result else 0
                                            spacing: dp(5)
                                            padding: dp(5)
                                            Label:
                                                text: "Prognosis:"
                                                font_size: dp(14)
                                                color: 0.2, 0.2, 0.2, 1
                                                size_hint_y: None
                                                height: dp(20)
                                            Label:
                                                text: root.prediction_text if root.has_result else ""
                                                font_size: dp(24)
                                                bold: True
                                                color: root.prognosis_color
                                                size_hint_y: None
                                                height: dp(40)
                                                canvas.before:
                                                    Color:
                                                        rgba: root.prognosis_bg_color
                                                    RoundedRectangle:
                                                        pos: self.pos
                                                        size: self.size
                                                        radius: [dp(8)]

                                        BoxLayout:
                                            orientation: 'vertical'
                                            size_hint_y: None
                                            height: dp(60) if root.has_result else 0
                                            opacity: 1 if root.has_result else 0
                                            spacing: dp(5)
                                            padding: dp(5)
                                            Label:
                                                text: "Confidence:"
                                                font_size: dp(14)
                                                color: 0.2, 0.2, 0.2, 1
                                                size_hint_y: None
                                                height: dp(20)
                                            Label:
                                                text: root.confidence_text if root.has_result else ""
                                                font_size: dp(20)
                                                bold: True
                                                color: 0.886, 0.478, 0.415, 1
                                                size_hint_y: None
                                                height: dp(30)

                                        Label:
                                            text: "Upload an image and click 'Detect'\\nto see results here."
                                            font_size: dp(14)
                                            color: 0.47, 0.47, 0.47, 1
                                            opacity: 0 if root.has_result else 1
                                            size_hint_y: 1 if not root.has_result else None
                                            height: 0 if root.has_result else dp(60)
                                            text_size: self.width - dp(20), None
                                            halign: 'center'
                                            valign: 'middle'

                                        # Spacer
                                        Widget:
                                            size_hint_y: None
                                            height: dp(30)